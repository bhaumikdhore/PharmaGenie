# Refill Alert Feature - Architecture & Flow Diagram

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FRONTEND (Next.js)                           â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  User Prescriptions Dashboard                            â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Prescription Table                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ RX-4518 | Lisinopril | Dr. Gupta | ... | Refill.. â”‚  â”‚   â”‚
â”‚  â”‚  â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚          â”‚ [ğŸ”” Refill Alert] [ğŸ‘ View] [ğŸ›’ Add]â”‚   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  Status: "refill-needed" â†’ Shows button            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  Status: "active"        â†’ No button               â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  Success/Error Message Card (appears after table)        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ âœ… Refill alert triggered for Lisinopril!         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚    N8N workflow initiated.                         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚    Customer will receive SMS/Email.                â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    (axios / fetch)
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND (FastAPI)                            â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ POST /api/refill-notifications/create                   â”‚   â”‚
â”‚  â”‚ â”œâ”€ customer_id: "user-123"                             â”‚   â”‚
â”‚  â”‚ â”œâ”€ medicine_name: "Lisinopril"                         â”‚   â”‚
â”‚  â”‚ â”œâ”€ dosage: "10mg once daily"                           â”‚   â”‚
â”‚  â”‚ â”œâ”€ quantity: 1                                         â”‚   â”‚
â”‚  â”‚ â””â”€ refill_days: 7                                      â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ Returns: { notification_id: 456, ... }                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Stores in Database:                                     â”‚   â”‚
â”‚  â”‚ â”œâ”€ MedicineRefillNotification                          â”‚   â”‚
â”‚  â”‚ â”‚  â”œâ”€ id: 456                                          â”‚   â”‚
â”‚  â”‚ â”‚  â”œâ”€ customer_id: "user-123"                          â”‚   â”‚
â”‚  â”‚ â”‚  â”œâ”€ medicine_name: "Lisinopril"                      â”‚   â”‚
â”‚  â”‚ â”‚  â”œâ”€ dosage: "10mg once daily"                        â”‚   â”‚
â”‚  â”‚ â”‚  â”œâ”€ refill_date: 2026-03-08                          â”‚   â”‚
â”‚  â”‚ â”‚  â””â”€ created_at: 2026-03-01 10:30:00                  â”‚   â”‚
â”‚  â”‚ â””â”€ status: "pending"                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ POST /api/refill-notifications/456/trigger-n8n         â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚ Prepares Webhook Payload:                             â”‚   â”‚
â”‚  â”‚ {                                                       â”‚   â”‚
â”‚  â”‚   "event": "refill_reminder_test",                     â”‚   â”‚
â”‚  â”‚   "notification_id": 456,                              â”‚   â”‚
â”‚  â”‚   "medicine_name": "Lisinopril",                       â”‚   â”‚
â”‚  â”‚   "dosage": "10mg once daily",                         â”‚   â”‚
â”‚  â”‚   "quantity": 1,                                       â”‚   â”‚
â”‚  â”‚   "refill_date": "2026-03-08",                         â”‚   â”‚
â”‚  â”‚   "customer_id": "user-123",                           â”‚   â”‚
â”‚  â”‚   "triggered_at": "2026-03-01T10:30:00Z"             â”‚   â”‚
â”‚  â”‚ }                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                      (httpx.post)
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   N8N WORKFLOW (Cloud)                          â”‚
â”‚    https://shiftry.app.n8n.cloud/webhook/order-created         â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Webhook Trigger                                         â”‚   â”‚
â”‚  â”‚ â””â”€ Receives JSON payload from backend                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Parse Notification Node                                 â”‚   â”‚
â”‚  â”‚ â””â”€ Extracts medicine_name, customer_id, dosage, etc.    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Switch / Condition Node                                 â”‚   â”‚
â”‚  â”‚ â”œâ”€ If alert_level == "critical" â†’ SMS (priority 1)     â”‚   â”‚
â”‚  â”‚ â””â”€ If alert_level == "warning"  â†’ Email (priority 2)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                  â†™                        â†˜                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ SMS Node             â”‚      â”‚ Email Node           â”‚        â”‚
â”‚   â”œâ”€ Phone: +919876..   â”‚      â”œâ”€ Email: user@ex...   â”‚        â”‚
â”‚   â”‚ Message:             â”‚      â”‚ Subject:             â”‚        â”‚
â”‚   â”‚ "Hi! Your Lisinoprilâ”‚      â”‚ "Refill Reminder"    â”‚        â”‚
â”‚   â”‚ refill is due on     â”‚      â”‚ Template:            â”‚        â”‚
â”‚   â”‚ March 8. Click here  â”‚      â”‚ "Your medicine X     â”‚        â”‚
â”‚   â”‚ to refill"           â”‚      â”‚ is due for refill"   â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                  â†“                        â†“                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚ Customer Receives SMS/Email Notification        â”‚           â”‚
â”‚   â”‚ âœ… SMS sent to +919876543210                    â”‚           â”‚
â”‚   â”‚ âœ… Email sent to user@example.com               â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Sequence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP-BY-STEP EXECUTION                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. USER CLICKS "Refill Alert" BUTTON
   â”œâ”€ Button state: disabled = false
   â””â”€ Icon: Bell (blue)

2. FRONTEND: triggerRefillNotification(rx) CALLED
   â”œâ”€ setRefillNotificationLoading[rx.id] = true
   â”œâ”€ Button shows: "Sending..." + Loader2 spinner
   â””â”€ Message cleared

3. FRONTEND: API POST /api/refill-notifications/create
   â”œâ”€ Payload:
   â”‚  â”œâ”€ customer_id: user?.id
   â”‚  â”œâ”€ medicine_name: rx.medication
   â”‚  â”œâ”€ dosage: rx.dosage
   â”‚  â”œâ”€ quantity: 1
   â”‚  â””â”€ refill_days: 7
   â””â”€ Response: { notification_id: 456, ... }

4. BACKEND: Create refill notification record
   â”œâ”€ Insert into MedicineRefillNotification table
   â”‚  â”œâ”€ id: 456 (auto-generated)
   â”‚  â”œâ”€ customer_id: "user-123"
   â”‚  â”œâ”€ medicine_name: "Lisinopril"
   â”‚  â”œâ”€ dosage: "10mg once daily"
   â”‚  â”œâ”€ quantity: 1
   â”‚  â”œâ”€ refill_date: 2026-03-08 (now + 7 days)
   â”‚  â”œâ”€ created_at: 2026-03-01 10:30:00
   â”‚  â””â”€ status: "pending"
   â””â”€ Return: { notification_id: 456, ... }

5. FRONTEND: API POST /api/refill-notifications/456/trigger-n8n
   â”œâ”€ Path: /api/refill-notifications/456/trigger-n8n
   â””â”€ Method: POST

6. BACKEND: Trigger N8N webhook
   â”œâ”€ Get notification from DB (id=456)
   â”œâ”€ Prepare payload:
   â”‚  â”œâ”€ event: "refill_reminder_test"
   â”‚  â”œâ”€ notification_id: 456
   â”‚  â”œâ”€ medicine_name: "Lisinopril"
   â”‚  â”œâ”€ dosage: "10mg once daily"
   â”‚  â”œâ”€ quantity: 1
   â”‚  â”œâ”€ refill_date: "2026-03-08"
   â”‚  â”œâ”€ customer_id: "user-123"
   â”‚  â””â”€ triggered_at: "2026-03-01T10:30:00Z"
   â”œâ”€ POST to N8N_ORDER_WEBHOOK
   â”‚  â””â”€ URL: https://shiftry.app.n8n.cloud/webhook/order-created
   â””â”€ Response: { status: "success", webhook_status: 200 }

7. N8N WORKFLOW: Process webhook
   â”œâ”€ Trigger: Webhook receives POST
   â”œâ”€ Parse: Extract medicine details
   â”œâ”€ Decision: Check alert level
   â”œâ”€ Send: SMS to phone number
   â”œâ”€ Send: Email to customer email
   â””â”€ Complete: Workflow execution done

8. CUSTOMER RECEIVES NOTIFICATION
   â”œâ”€ SMS: "Hi! Your Lisinopril refill is due on March 8..."
   â””â”€ Email: "Refill Reminder: Your medicine Lisinopril..."

9. FRONTEND: Show success message
   â”œâ”€ setRefillNotificationLoading[rx.id] = false
   â”œâ”€ Button shows: "Refill Alert" + Bell icon (enabled)
   â””â”€ Message card:
      â”œâ”€ Type: "success"
      â”œâ”€ Icon: CheckCircle2 (green)
      â””â”€ Text: "âœ… Refill alert triggered for Lisinopril!
                   N8N workflow initiated. Customer will
                   receive notification via SMS/Email."

10. USER DISMISSES MESSAGE
    â””â”€ Click X button â†’ Message disappears
```

## Component State Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BUTTON STATE MACHINE                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Initial State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BUTTON: IDLE       â”‚
â”‚ Text: "Refill Alert" â”‚
â”‚ Icon: Bell           â”‚
â”‚ Disabled: false      â”‚
â”‚ Color: Primary/Blue  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ onClick()
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BUTTON: LOADING      â”‚
â”‚ Text: "Sending..."   â”‚
â”‚ Icon: Loader2        â”‚
â”‚ Disabled: true       â”‚
â”‚ Spinner: true        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ Success â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚              â”‚ BUTTON: IDLE (again) â”‚
         â”‚              â”‚ Icon: Bell           â”‚
         â”‚              â”‚ Disabled: false      â”‚
         â”‚              â”‚ Message: âœ… Success  â”‚
         â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â””â”€ Error â”€â”€â”€â”€â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ BUTTON: IDLE (again) â”‚
                        â”‚ Icon: Bell           â”‚
                        â”‚ Disabled: false      â”‚
                        â”‚ Message: âŒ Error    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Database Schema (Simplified)

```sql
TABLE: medicine_refill_notification
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Column                 â”‚ Type         â”‚ Description â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id                     â”‚ INT (PK)     â”‚ Auto-inc    â”‚
â”‚ customer_id            â”‚ VARCHAR(255) â”‚ FK          â”‚
â”‚ medicine_name          â”‚ VARCHAR(255) â”‚ Name        â”‚
â”‚ dosage                 â”‚ VARCHAR(100) â”‚ e.g. 10mg   â”‚
â”‚ quantity               â”‚ INT          â”‚ Count       â”‚
â”‚ refill_date            â”‚ DATETIME     â”‚ Due date    â”‚
â”‚ status                 â”‚ VARCHAR(50)  â”‚ pending...  â”‚
â”‚ created_at             â”‚ DATETIME     â”‚ Created     â”‚
â”‚ triggered_at           â”‚ DATETIME     â”‚ N8N trigger â”‚
â”‚ n8n_workflow_id        â”‚ VARCHAR(255) â”‚ N8N exec    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Error Handling

```
Possible Errors:

1. customer_id is null/missing
   â””â”€ Response: 400 Bad Request
   â””â”€ Message: "customer_id is required"

2. Notification not found
   â””â”€ Response: 404 Not Found
   â””â”€ Message: "Notification not found"

3. N8N_ORDER_WEBHOOK not configured
   â””â”€ Response: 500 Internal Server Error
   â””â”€ Message: "N8N_ORDER_WEBHOOK is not configured"

4. N8N webhook endpoint down
   â””â”€ Response: 502 Bad Gateway
   â””â”€ Message: "N8N webhook returned [status]: [error]"

5. Network timeout
   â””â”€ Response: 408 Request Timeout
   â””â”€ Message: "Request timeout connecting to N8N"

Frontend handles all errors and displays:
â”œâ”€ Type: "error"
â”œâ”€ Icon: AlertTriangle (red)
â””â”€ Text: "âŒ Error: [error message from backend]"
```

---

**Diagram Version:** 1.0
**Last Updated:** March 1, 2026
**Status:** âœ… Complete and Tested
